# ============================================================================
# Observer Backend - Production Environment Configuration
# ============================================================================
# Copy this file to .env and fill in the actual values
# Location: /home/s_observerdev/observer_backend/.env
# ============================================================================

# ============================================================================
# DJANGO CORE SETTINGS
# ============================================================================
DJANGO_SETTINGS_MODULE=backend.settings.prd
SECRET_KEY=CHANGE_THIS_TO_A_STRONG_SECRET_KEY_MINIMUM_50_CHARACTERS
DEBUG=False
ALLOWED_HOSTS=observer-dev.pmacs.upenn.edu,localhost,127.0.0.1

# ============================================================================
# SECURITY SETTINGS
# ============================================================================
SECURE_SSL_REDIRECT=True
SESSION_COOKIE_SECURE=True
CSRF_COOKIE_SECURE=True

# ============================================================================
# CROSS-SUBDOMAIN CONFIGURATION
# ============================================================================
# IMPORTANT: Backend and Frontend are on DIFFERENT subdomains:
#   - Backend:  observer-dev.pmacs.upenn.edu
#   - Frontend: observer-dev-d.pmacs.upenn.edu
#
# This requires specific CORS and CSRF configuration:

# Frontend URL - Used in email verification links and redirects
FRONTEND_URL=https://observer-dev-d.pmacs.upenn.edu

# CSRF Trusted Origins - MUST include BOTH backend AND frontend domains
# - Backend domain: Required for accessing /admin and API endpoints directly
# - Frontend domain: Required for API calls from the frontend
# Without the backend domain here, accessing /admin will redirect to 127.0.0.1:8000
CSRF_TRUSTED_ORIGINS=https://observer-dev.pmacs.upenn.edu,https://observer-dev-d.pmacs.upenn.edu

# CORS Allowed Origins - Should ONLY include frontend domain
# This allows the frontend to make API calls to the backend
CORS_ALLOWED_ORIGINS=https://observer-dev-d.pmacs.upenn.edu

# Documentation URL - Points to backend (where Swagger/Redoc is served)
DOCUMENTATION_URL=https://observer-dev.pmacs.upenn.edu/docs/

# ============================================================================
# DATABASE CONFIGURATION - ACCOUNTS
# ============================================================================
ACCOUNTS_DB_NAME=observer_accounts
ACCOUNTS_DB_USER=observer_user
ACCOUNTS_DB_PASSWORD=CHANGE_THIS_PASSWORD
ACCOUNTS_DB_HOST=localhost
ACCOUNTS_DB_PORT=3306

# ============================================================================
# DATABASE CONFIGURATION - CLINICAL
# ============================================================================
CLINICAL_DB_NAME=observer_clinical
CLINICAL_DB_USER=observer_user
CLINICAL_DB_PASSWORD=CHANGE_THIS_PASSWORD
CLINICAL_DB_HOST=localhost
CLINICAL_DB_PORT=3306

# ============================================================================
# DATABASE CONFIGURATION - RESEARCH
# ============================================================================
RESEARCH_DB_NAME=observer_research
RESEARCH_DB_USER=observer_user
RESEARCH_DB_PASSWORD=CHANGE_THIS_PASSWORD
RESEARCH_DB_HOST=localhost
RESEARCH_DB_PORT=3306

# ============================================================================
# AZURE STORAGE CONFIGURATION
# ============================================================================
AZURE_STORAGE_ACCOUNT_NAME=your_storage_account_name
AZURE_STORAGE_FILE_SYSTEM_NAME=observer-encounters
AZURE_SAS_TOKEN=your_sas_token_here

# ============================================================================
# EMAIL CONFIGURATION
# ============================================================================
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your_email@upenn.edu
EMAIL_HOST_PASSWORD=your_app_specific_password
DEFAULT_FROM_EMAIL=Observer Platform <noreply@observer-dev.pmacs.upenn.edu>

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
LOG_FILE=/home/s_observerdev/logs/django_prd.log
ERROR_LOG_FILE=/home/s_observerdev/logs/django_error.log

# ============================================================================
# HEALTH CHECK CONFIGURATION
# ============================================================================
# Add load balancer IPs or monitoring service IPs
HEALTH_CHECK_ALLOWED_IPS=127.0.0.1,::1

# ============================================================================
# RATE LIMITING CONFIGURATION
# ============================================================================
RATE_LIMIT_LOGIN=5/m
RATE_LIMIT_REGISTRATION=3/m
RATE_LIMIT_PASSWORD_CHANGE=10/m
RATE_LIMIT_PASSWORD_RESET_REQUEST=3/m
RATE_LIMIT_PASSWORD_RESET_CONFIRM=5/m

# ============================================================================
# OPTIONAL: REDIS CONFIGURATION (Recommended for Production)
# ============================================================================
# Uncomment and configure if using Redis for caching/sessions
# REDIS_URL=redis://localhost:6379/0

# ============================================================================
# OPTIONAL: CROSS-SUBDOMAIN COOKIE SHARING
# ============================================================================
# If you need cookies to be shared between backend and frontend subdomains,
# uncomment these settings. This is required if:
# - Frontend needs to access authentication cookies set by backend
# - You're using cookie-based JWT authentication across subdomains
#
# WARNING: This allows ALL *.pmacs.upenn.edu subdomains to access the cookies.
# Only enable if this is acceptable in your security policy.
#
# SESSION_COOKIE_DOMAIN=.pmacs.upenn.edu
# CSRF_COOKIE_DOMAIN=.pmacs.upenn.edu
#
# Note: The leading dot (.) is important - it enables subdomain sharing.
# Without these settings, cookies are only accessible on the exact subdomain
# where they were set (observer-dev.pmacs.upenn.edu cannot read cookies from
# observer-dev-d.pmacs.upenn.edu and vice versa).

# ============================================================================
# NOTES
# ============================================================================
# 1. Generate SECRET_KEY using: python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
# 2. Ensure database user has appropriate permissions on all three databases
# 3. Azure SAS token should have read/write permissions and appropriate expiration
# 4. Email password should be an app-specific password, not your main password
# 5. CSRF_TRUSTED_ORIGINS must include BOTH backend and frontend domains
# 6. CORS_ALLOWED_ORIGINS should only include frontend domain
# 7. For HEALTH_CHECK_ALLOWED_IPS, add your monitoring service IPs
# 8. If authentication cookies aren't working between frontend and backend,
#    you may need to enable SESSION_COOKIE_DOMAIN and CSRF_COOKIE_DOMAIN above
