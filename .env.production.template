# ============================================================================
# Observer Backend - Production Environment Configuration
# ============================================================================
# Copy this file to .env and fill in the actual values
# Location: /home/s_observerdev/observer_backend/.env
# ============================================================================

# ============================================================================
# DJANGO CORE SETTINGS
# ============================================================================
DJANGO_SETTINGS_MODULE=backend.settings.prd
SECRET_KEY=CHANGE_THIS_TO_A_STRONG_SECRET_KEY_MINIMUM_50_CHARACTERS
DEBUG=False
ALLOWED_HOSTS=observer-dev.pmacs.upenn.edu,localhost,127.0.0.1

# ============================================================================
# SECURITY & SSL SETTINGS
# ============================================================================
SECURE_SSL_REDIRECT=True
SESSION_COOKIE_SECURE=True
CSRF_COOKIE_SECURE=True

# ============================================================================
# CROSS-SUBDOMAIN CONFIGURATION (REQUIRED FOR PRODUCTION)
# ============================================================================
# IMPORTANT: Backend and Frontend are on DIFFERENT subdomains:
#   - Backend:  observer-dev.pmacs.upenn.edu
#   - Frontend: observer-dev-d.pmacs.upenn.edu

# Frontend URL - Used in email verification links and redirects
FRONTEND_URL=https://observer-dev-d.pmacs.upenn.edu

# Documentation URL - Points to backend (where Swagger/Redoc is served)
DOCUMENTATION_URL=https://observer-dev.pmacs.upenn.edu/docs/

# CSRF Trusted Origins - MUST include BOTH backend AND frontend domains
# - Backend domain: Required for accessing /admin and API endpoints directly
# - Frontend domain: Required for API calls from the frontend
# Without the backend domain here, accessing /admin will redirect to 127.0.0.1:8000
CSRF_TRUSTED_ORIGINS=https://observer-dev.pmacs.upenn.edu,https://observer-dev-d.pmacs.upenn.edu

# CORS Allowed Origins - Should ONLY include frontend domain
# This allows the frontend to make API calls to the backend
CORS_ALLOWED_ORIGINS=https://observer-dev-d.pmacs.upenn.edu

# Cookie Domain Settings - REQUIRED for cross-subdomain authentication
# CRITICAL: These settings enable cookies to work across different subdomains
# The leading dot (.) allows cookies to work across all *.pmacs.upenn.edu subdomains
# Combined with SameSite=None (set in prd.py), this enables cross-origin authentication
SESSION_COOKIE_DOMAIN=.pmacs.upenn.edu
CSRF_COOKIE_DOMAIN=.pmacs.upenn.edu

# ============================================================================
# DATABASE CONFIGURATION (MariaDB)
# ============================================================================
# Database Settings - Docker Configuration
DB_USER=observer_user
DB_PASSWORD=CHANGE_THIS_PASSWORD
DB_HOST=localhost
DB_PORT=3306

# Accounts Database - User authentication and authorization
ACCOUNTS_DB_NAME=observer_accounts
ACCOUNTS_DB_USER=observer_user
ACCOUNTS_DB_PASSWORD=CHANGE_THIS_PASSWORD
ACCOUNTS_DB_HOST=localhost
ACCOUNTS_DB_PORT=3306

# Clinical Database - Patient encounters and clinical data
CLINICAL_DB_NAME=observer_clinical
CLINICAL_DB_USER=observer_user
CLINICAL_DB_PASSWORD=CHANGE_THIS_PASSWORD
CLINICAL_DB_HOST=localhost
CLINICAL_DB_PORT=3306

# Research Database - Research projects and analysis
RESEARCH_DB_NAME=observer_research
RESEARCH_DB_USER=observer_user
RESEARCH_DB_PASSWORD=CHANGE_THIS_PASSWORD
RESEARCH_DB_HOST=localhost
RESEARCH_DB_PORT=3306

# ============================================================================
# EXTERNAL SERVICES
# ============================================================================
# Azure Storage - For encounter media files
AZURE_STORAGE_ACCOUNT_NAME=your_storage_account_name
AZURE_STORAGE_FILE_SYSTEM_NAME=observer-encounters
AZURE_SAS_TOKEN=your_sas_token_here

# Email Configuration - For verification and notification emails
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your_email@upenn.edu
EMAIL_HOST_PASSWORD=your_app_specific_password
DEFAULT_FROM_EMAIL=Observer Platform <noreply@observer-dev.pmacs.upenn.edu>

# ============================================================================
# LOGGING & MONITORING
# ============================================================================
# Application Logs
LOG_FILE=/home/s_observerdev/logs/django_prd.log
ERROR_LOG_FILE=/home/s_observerdev/logs/django_error.log

# Health Check Configuration - Add load balancer or monitoring service IPs
HEALTH_CHECK_ALLOWED_IPS=127.0.0.1,::1

# ============================================================================
# RATE LIMITING
# ============================================================================
RATE_LIMIT_LOGIN=5/m
RATE_LIMIT_REGISTRATION=3/m
RATE_LIMIT_PASSWORD_CHANGE=10/m
RATE_LIMIT_PASSWORD_RESET_REQUEST=3/m
RATE_LIMIT_PASSWORD_RESET_CONFIRM=5/m
RATE_LIMIT_EMAIL_VERIFICATION=10/m
RATE_LIMIT_PROFILE_UPDATE=10/m
RATE_LIMIT_USERNAME_UPDATE=5/m
RATE_LIMIT_LOGOUT=5/m
RATE_LIMIT_TOKEN_REFRESH=30/m
RATE_LIMIT_TOKEN_VERIFY=30/m

# ============================================================================
# OPTIONAL: REDIS CONFIGURATION (Recommended for Production)
# ============================================================================
# Uncomment and configure if using Redis for caching/sessions
# REDIS_URL=redis://localhost:6379/0

# ============================================================================
# DEPLOYMENT NOTES
# ============================================================================
# 1. SECRET_KEY: Generate using: python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
# 2. Database Permissions: Ensure observer_user has full access to all three databases
# 3. Azure SAS Token: Must have read/write permissions with appropriate expiration date
# 4. Email Password: Use app-specific password, not your main account password
# 5. Cross-Domain Settings: SESSION_COOKIE_DOMAIN and CSRF_COOKIE_DOMAIN are REQUIRED for production
# 6. CSRF Origins: Must include BOTH backend and frontend domains
# 7. CORS Origins: Should ONLY include frontend domain
# 8. Health Checks: Add your load balancer and monitoring service IPs to HEALTH_CHECK_ALLOWED_IPS
# 9. JWT Token Lifetimes: Set in backend/settings/base.py (15 min access, 24h refresh for HIPAA compliance)
